<!doctype html><html dir=ltr lang=en data-theme class="html theme--light"><head><meta charset=utf-8><title>NodeMcu (ESP8266) water level monitor with a voltage sensor |
Slawomir Jasinski</title><meta name=generator content="Hugo 0.111.3"><meta name=viewport content="width=device-width,initial-scale=1,viewport-fit=cover"><meta name=author content="Slawomir Jasinski"><meta name=description content="Forward-thinking Solutions Architect excels in cloud migration, optimizing infrastructure for peak performance and security, deploying tailored solutions."><link rel=stylesheet href=/scss/main.min.1cac29897bb941adf4246700acb99deffbfdf35a02ffc4ae81484456ebe430c3.css integrity="sha256-HKwpiXu5Qa30JGcArLmd7/v981oC/8SugUhEVuvkMMM=" crossorigin=anonymous type=text/css><link rel=stylesheet href=/css/markupHighlight.min.73ccfdf28df555e11009c13c20ced067af3cb021504cba43644c705930428b00.css integrity="sha256-c8z98o31VeEQCcE8IM7QZ688sCFQTLpDZExwWTBCiwA=" crossorigin=anonymous type=text/css><link rel=stylesheet href=/css/custom.min.ca7fc969129c33659f61ae054e9e3eaf594449bc195e8842a131bc4d43284de7.css integrity="sha256-yn/JaRKcM2WfYa4FTp4+r1lESbwZXohCoTG8TUMoTec=" crossorigin=anonymous media=screen><link rel=stylesheet href=/fontawesome/css/fontawesome.min.137b1cf3cea9a8adb7884343a9a5ddddf4280f59153f74dc782fb7f7bf0d0519.css integrity="sha256-E3sc886pqK23iENDqaXd3fQoD1kVP3TceC+3978NBRk=" crossorigin=anonymous type=text/css><link rel=stylesheet href=/fontawesome/css/solid.min.e65dc5b48fb5f39b142360c57c3a215744c94e56c755c929cc3e88fe12aab4d3.css integrity="sha256-5l3FtI+185sUI2DFfDohV0TJTlbHVckpzD6I/hKqtNM=" crossorigin=anonymous type=text/css><link rel=stylesheet href=/fontawesome/css/regular.min.6f4f16d58da1c82c0c3a3436e021a3d39b4742f741192c546e73e947eacfd92f.css integrity="sha256-b08W1Y2hyCwMOjQ24CGj05tHQvdBGSxUbnPpR+rP2S8=" crossorigin=anonymous type=text/css><link rel=stylesheet href=/fontawesome/css/brands.min.e10425ad768bc98ff1fb272a0ac8420f9d1ba22f0612c08ff1010c95080ffe7e.css integrity="sha256-4QQlrXaLyY/x+ycqCshCD50boi8GEsCP8QEMlQgP/n4=" crossorigin=anonymous type=text/css><link rel="shortcut icon" href=/favicon.ico type=image/x-icon><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=canonical href=/nodemcu-esp8266-water-level-monitor-with-a-voltage-sensor/><script type=text/javascript src=/js/anatole-header.min.f9132794301a01ff16550ed66763482bd848f62243d278f5e550229a158bfd32.js integrity="sha256-+RMnlDAaAf8WVQ7WZ2NIK9hI9iJD0nj15VAimhWL/TI=" crossorigin=anonymous></script>
<script type=text/javascript src=/js/anatole-theme-switcher.min.d6d329d93844b162e8bed1e915619625ca91687952177552b9b3e211014a2957.js integrity="sha256-1tMp2ThEsWLovtHpFWGWJcqRaHlSF3VSubPiEQFKKVc=" crossorigin=anonymous></script><meta name=twitter:card content="summary"><meta name=twitter:title content="NodeMcu (ESP8266) water level monitor with a voltage sensor"><meta name=twitter:description content="This subject in the theory looks very easy. Just get  
 
 
     
 
 NodeMcu
  board, plug sensor from the family of sensors (HY-SRF05, HC-SR04), some kind of voltage sensor and we are good to go. But you can get couple of unexpected issues here. Let’s start from the NodeMcu unit. It’s specific."><meta property="og:title" content="NodeMcu (ESP8266) water level monitor with a voltage sensor"><meta property="og:description" content="This subject in the theory looks very easy. Just get  
 
 
     
 
 NodeMcu
  board, plug sensor from the family of sensors (HY-SRF05, HC-SR04), some kind of voltage sensor and we are good to go. But you can get couple of unexpected issues here. Let’s start from the NodeMcu unit. It’s specific."><meta property="og:type" content="article"><meta property="og:url" content="/nodemcu-esp8266-water-level-monitor-with-a-voltage-sensor/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2021-01-08T15:39:30+00:00"><meta property="article:modified_time" content="2021-01-08T15:39:30+00:00"><meta property="og:site_name" content="Slawomir Slav Jasinski"><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","articleSection":"posts","name":"NodeMcu (ESP8266) water level monitor with a voltage sensor","headline":"NodeMcu (ESP8266) water level monitor with a voltage sensor","alternativeHeadline":"","description":"
      
        \u003cp\u003eThis subject in the theory looks very easy. Just get  \n \n \n     \n \n \u003ca href=\u0022https:\/\/en.wikipedia.org\/wiki\/NodeMCU\u0022\u003eNodeMcu\u003c\/a\u003e\n  board, plug sensor from the family of sensors (HY-SRF05, HC-SR04), some kind of voltage sensor and we are good to go. But you can get couple of unexpected issues here. Let’s start from the NodeMcu unit. It’s specific.\u003c\/p\u003e


      


    ","inLanguage":"en-us","isFamilyFriendly":"true","mainEntityOfPage":{"@type":"WebPage","@id":"\/nodemcu-esp8266-water-level-monitor-with-a-voltage-sensor\/"},"author":{"@type":"Person","name":"admin"},"creator":{"@type":"Person","name":"admin"},"accountablePerson":{"@type":"Person","name":"admin"},"copyrightHolder":{"@type":"Person","name":"admin"},"copyrightYear":"2021","dateCreated":"2021-01-08T15:39:30.00Z","datePublished":"2021-01-08T15:39:30.00Z","dateModified":"2021-01-08T15:39:30.00Z","publisher":{"@type":"Organization","name":"admin","url":"/","logo":{"@type":"ImageObject","url":"\/favicon-32x32.png","width":"32","height":"32"}},"image":[],"url":"\/nodemcu-esp8266-water-level-monitor-with-a-voltage-sensor\/","wordCount":"582","genre":["Arduino"],"keywords":[]}</script></head><body class=body><div class=wrapper><aside class=wrapper__sidebar><div class="sidebar
animated fadeInDown"><div class=sidebar__content><div class=sidebar__introduction><img class=sidebar__introduction-profileimage src=/images/DSF1609.jpg alt="profile picture"><div class=sidebar__introduction-title><a href=/>Slawomir Slav Jasinski</a></div><div class=sidebar__introduction-description><p>Forward-thinking Solutions Architect excels in cloud migration, optimizing infrastructure for peak performance and security, deploying tailored solutions.</p></div></div><ul class=sidebar__list><li class=sidebar__list-item><a href=https://linkedin.com/in/slawomirjasinski target=_blank rel="noopener me" aria-label=Linkedin title=Linkedin><i class="fab fa-linkedin fa-2x" aria-hidden=true></i></a></li><li class=sidebar__list-item><a href=https://github.com/slav123 target=_blank rel="noopener me" aria-label title><i class="fab fa-github fa-2x" aria-hidden=true></i></a></li><li class=sidebar__list-item><a href=https://stackoverflow.com/users/432573/ target=_blank rel="noopener me" aria-label="Stack Overflow" title="Stack Overflow"><i class="fab fa-stack-overflow fa-2x" aria-hidden=true></i></a></li><li class=sidebar__list-item><a href=https://twitter.com/slavomirj target=_blank rel="noopener me" aria-label title><i class="fab fa-twitter fa-2x" aria-hidden=true></i></a></li><li class=sidebar__list-item><a href=https://www.instagram.com/slavomirj/ target=_blank rel="noopener me" aria-label=instagram title=instagram><i class="fab fa-instagram fa-2x" aria-hidden=true></i></a></li><li class=sidebar__list-item><a href=https://www.yakconsulting.com target=_blank rel="noopener me" aria-label=business title=business><i class="fas fa-business-time fa-2x" aria-hidden=true></i></a></li><li class=sidebar__list-item><a href=mailto:slav123@gmail.com target=_blank rel="noopener me" aria-label=e-mail title=e-mail><i class="fas fa-envelope fa-2x" aria-hidden=true></i></a></li></ul></div><footer class="footer footer__sidebar"><ul class=footer__list><li class=footer__item>&copy;
2011-2024</li></ul></footer><script type=text/javascript src=/js/medium-zoom.min.1248fa75275e5ef0cbef27e8c1e27dc507c445ae3a2c7d2ed0be0809555dac64.js integrity="sha256-Ekj6dSdeXvDL7yfoweJ9xQfERa46LH0u0L4ICVVdrGQ=" crossorigin=anonymous></script>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-S3DZNELTH9"></script>
<script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-S3DZNELTH9")</script></div></aside><main class=wrapper__main><header class=header><div class="animated fadeInDown"><a role=button class=navbar-burger data-target=navMenu aria-label=menu aria-expanded=false><span aria-hidden=true class=navbar-burger__line></span>
<span aria-hidden=true class=navbar-burger__line></span>
<span aria-hidden=true class=navbar-burger__line></span></a><nav class=nav><ul class=nav__list id=navMenu><li class=nav__list-item><a href=/about/ title="About Slawomir Jasinski">About Slawomir Jasinski</a></li><li class=nav__list-item><a href=/posts/ title>Blog</a></li><li class=nav__list-item><a href=/categories/arduino/ title>Arduino</a></li><li class=nav__list-item><a href=/categories/work/ title>Work</a></li><li class=nav__list-item><a href=/contact/ title=Contact>Contact</a></li></ul><ul class="nav__list nav__list--end"><li class=nav__list-item><div class=themeswitch><a title="Switch Theme"><i class="fas fa-adjust fa-fw" aria-hidden=true></i></a></div></li></ul></nav></div></header><div class="post
animated fadeInDown"><div class=post__thumbnail-wrapper><img class=post__thumbnail src=/images/2021/01/IMG_3854-scaled.jpeg alt="Thumbnail image"></div><div class=post__content><h1>NodeMcu (ESP8266) Water Level Monitor With a Voltage Sensor</h1><ul class=post__meta><li class=post__meta-item><em class="fas fa-calendar-day post__meta-icon"></em>
<span class=post__meta-text>Fri, Jan 8, 2021</span></li><li class=post__meta-item><em class="fas fa-stopwatch post__meta-icon"></em>
<span class=post__meta-text>3-minute read</span></li></ul><p>This subject in the theory looks very easy. Just get
<a href=https://en.wikipedia.org/wiki/NodeMCU>NodeMcu</a>
board, plug sensor from the family of sensors (HY-SRF05, HC-SR04), some kind of voltage sensor and we are good to go. But you can get couple of unexpected issues here. Let’s start from the NodeMcu unit. It’s specific.</p><h2 id=weird-nodemcu-pin-arrangement>Weird NodeMcu PIN arrangement</h2><p>First thing first pins on the board doesn’t match pins in the code. I mean – addressing is not se straight forward like in regular Arduino boards.
<a href=https://nodemcu.readthedocs.io/en/latest/modules/gpio/>Here is a official mapping of pin outs</a>
.</p><p><img src=/images/2021/01/nodemcu-pinout.png alt="NodeMcu pin mapping" title="NodeMcu pin mapping"></p><p>A little bit of helper code:</p><pre tabindex=0><code>#define PIN_WIRE_SDA (4)
#define PIN_WIRE_SCL (5)

static const uint8_t SDA = PIN_WIRE_SDA;
static const uint8_t SCL = PIN_WIRE_SCL;

static const uint8_t LED_BUILTIN = 16;
static const uint8_t BUILTIN_LED = 16;

static const uint8_t D0   = 16;
static const uint8_t D1   = 5;
static const uint8_t D2   = 4;
static const uint8_t D3   = 0;
static const uint8_t D4   = 2;
static const uint8_t D5   = 14;
static const uint8_t D6   = 12;
static const uint8_t D7   = 13;
static const uint8_t D8   = 15;
static const uint8_t D9   = 3;
static const uint8_t D10 = 1;
</code></pre><p>It’s good to have something to map them according to “regular” naming – so do whenever i have to use digital pin D0 – use D0 instead of trying to guess 16 and so on.</p><h2 id=reserved-pins>Reserved Pins</h2><p>You don’t hear about it often, but for example pins D3 & D4 (GPIO2 and GPIO0) need to be both HIGH to boot in normal execution mode. What’s the isse then ? When I hooked my HC-SR04 to this pins it provides LOW in idle state – so my board didn’t boot. Solution – move on to higher pins.</p><h2 id=voltage-sensor-calculations>Voltage Sensor calculations</h2><p>Every other example found in the web gives these calculations:</p><pre tabindex=0><code>const int voltageSensor = A0;

float vOUT = 0.0;
float vIN = 0.0;
float R1 = 30000.0;
float R2 = 7500.0;
int value = 0;

value = analogRead(voltageSensor);
vOUT = (value * 5.0) / 1024.0;
vIN = vOUT / (R2/(R1+R2));
</code></pre><p><img src=/images/2021/01/Standard-Voltage-Sensor-Module-Test-Electronic-Bricks-For-Robot-For-Arduino.jpg_Q90.jpg alt></p><blockquote><p>Without going into to much details – we do have value of resistors here (R1, R2) and then magic formulas vOUT and vIN – nobody mentions that magical number 5.0 is not random… it’s reverence value of your board. So 5.0 it’s good for regular Arduino board powered by 5.0V but not so good for NodeMcu which has 3.3V…</p></blockquote><h2 id=powering-whole-module>Powering whole module</h2><p>NodeMcu will be happy with 3.3V but HC-SR04 needs a little bit more. Power your sensor with 5V – otherwise your distance sensor wont work correctly.</p><p>And also – not sure how frequent you need your data to be updated, but small batter won’t stand to long. We have to save some energy. The easiest way to save the juice is to use sleep mode for out board.</p><p>There are four types of sleep modes for the ESP8266: No-sleep, Modem-sleep, Light-sleep, and Deep-sleep.</p><p><img src=/images/2021/01/esp8266_sleep_options.png alt title="ESP8266 board sleep modes"></p><p>I wouldn’t bother with anything then deep-sleep. There is a small requirement – If you use the deep sleep mode, you have to connect D0 with RST on the ESP8266 NodeMCU. You can find a lot of
<a href=https://diyi0t.com/how-to-reduce-the-esp8266-power-consumption/>good articles</a>
around this subject. So our goal is to sleep most of the time. We just need check every now and then water level, and batter level. Send results to out collector service and go back to sleep to preserve energy.</p><p>So finally I end up with code bellow. Let me know if you have any questions.</p><h2 id=the-code>The Code</h2><script type=application/javascript src=https://gist.github.com/slav123/00e2231742edd91ad27472369a965654.js></script></div><div class=post__footer><span><a class=category href=/categories/arduino/>Arduino</a></span></div></div></main></div><footer class="footer footer__base"><ul class=footer__list><li class=footer__item>&copy;
2011-2024</li></ul></footer><script type=text/javascript src=/js/medium-zoom.min.1248fa75275e5ef0cbef27e8c1e27dc507c445ae3a2c7d2ed0be0809555dac64.js integrity="sha256-Ekj6dSdeXvDL7yfoweJ9xQfERa46LH0u0L4ICVVdrGQ=" crossorigin=anonymous></script>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-S3DZNELTH9"></script>
<script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-S3DZNELTH9")</script></body></html>